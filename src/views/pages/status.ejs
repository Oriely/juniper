<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head') %> 
</head>
<body>
    <%- include('../partials/navigation') %> 

    <div class="container center-h" >
        <div class="wrapper">
            <canvas id="memory-usage" width="450" height="250" aria-label="Hello ARIA World" role="img">

            </canvas>
        </div>
    </div>
    <%- include('../partials/scripts') %> 
    <script src="./js/socket.io.js"></script>
    <script src="./js/chart.js"></script>
    <script>
       "use strict"

        var socket = io();

        function addData(chart, label, data) {
            chart.data.labels.push(label);
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(data);
            });
            chart.update();
        }

        function removeData(chart) {
            chart.data.labels.pop();
            chart.data.datasets.forEach((dataset) => {
                dataset.data.pop();
            });
            chart.update();
        }


        const wrapper = document.querySelector('.wrapper');
        const ctx = document.querySelector('#memory-usage').getContext('2d');
        let memoryUsageChart = null;

        const chartData = [];

        socket.once('osstatus', (os) => {



            memoryUsageChart = new Chart(ctx, {
                type: "line",
                data: {
                    labels: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],
                    datasets: [{
                        backgroundColor: "rgba(255,255,255,1.0)",
                        borderColor:  "rgba(255,255,255,1.0)",
                        data: chartData
                    }]
                },
                options:{
                    scales: {
                        y:{
                            beginsAtZero:true,
                            min:0,
                            max:os.memory.totalMemMb
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                            label: (ctx) => (`${ctx.dataset.label}: ${ctx.raw}`)
                            }
                        }
                    }
                }
            });
            
            console.log( memoryUsageChart)
            socket.on('osstatus', (os) => {
                if(memoryUsageChart.data.datasets[0].data.length >= 60) memoryUsageChart.data.datasets[0].data.pop();
                memoryUsageChart.data.datasets[0].data.push(os.memory.usedMemMb);
                memoryUsageChart.update();
                console.log(os.memory.usedMemPercentage / 10)
            })
        })

    </script>
</body>
</html>